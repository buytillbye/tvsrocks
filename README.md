# üìà Stocks10 Premarket Watcher

–ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∏–π —Å–∫–∞–Ω–µ—Ä –∞–∫—Ü—ñ–π –°–®–ê –∑ –º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥–æ–º –ø—Ä–µ–º–∞—Ä–∫–µ—Ç—É —Ç–∞ —Å–ø–æ–≤—ñ—â–µ–Ω–Ω—è–º–∏ –≤ Telegram.

## üéØ –©–æ —Ä–æ–±–∏—Ç—å —Ü–µ–π –ø—Ä–æ–µ–∫—Ç?

–ü—Ä–æ–µ–∫—Ç —Å–∫–∞–Ω—É—î –∞–∫—Ü—ñ—ó –Ω–∞ –∞–º–µ—Ä–∏–∫–∞–Ω—Å—å–∫–∏—Ö –±—ñ—Ä–∂–∞—Ö (NASDAQ, NYSE, AMEX) –ø—ñ–¥ —á–∞—Å **–ø—Ä–µ–º–∞—Ä–∫–µ—Ç—É** (04:00‚Äì09:30 –∑–∞ —á–∞—Å–æ–º –ù—å—é-–ô–æ—Ä–∫—É) —Ç–∞ —à—É–∫–∞—î –∞–∫—Ü—ñ—ó –∑:

- **–ó—Ä–æ—Å—Ç–∞–Ω–Ω—è–º 10%+** –Ω–∞ –ø—Ä–µ–º–∞—Ä–∫–µ—Ç—ñ
- **Float ‚â§ 15M** (–Ω–µ–≤–µ–ª–∏–∫–∏–π free float)
- **–û–±—Å—è–≥–æ–º –ø—Ä–µ–º–∞—Ä–∫–µ—Ç—É > 50,000** –∞–∫—Ü—ñ–π
- **–¶—ñ–Ω–æ—é ‚â• $0.80**

–ü—Ä–∏ –∑–Ω–∞—Ö–æ–¥–∂–µ–Ω–Ω—ñ –Ω–æ–≤–∏—Ö –∞–∫—Ü—ñ–π, —Å–∏—Å—Ç–µ–º–∞ –Ω–∞–¥—Å–∏–ª–∞—î —Å–ø–æ–≤—ñ—â–µ–Ω–Ω—è –≤ Telegram –∑ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—î—é –ø—Ä–æ –∞–∫—Ü—ñ—é.

## üèóÔ∏è –ê—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç—É

```
tvstocks/
‚îú‚îÄ‚îÄ app.js                 # –ì–æ–ª–æ–≤–Ω–∞ —Ç–æ—á–∫–∞ –≤—Ö–æ–¥—É
‚îú‚îÄ‚îÄ config.js              # –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è –∑ .env
‚îú‚îÄ‚îÄ scannerService.js      # –°–µ—Ä–≤—ñ—Å —Å–∫–∞–Ω—É–≤–∞–Ω–Ω—è (gatekeeper)
‚îú‚îÄ‚îÄ stockService.js        # –û–±—Ä–æ–±–∫–∞ –¥–∞–Ω–∏—Ö –∞–∫—Ü—ñ–π
‚îú‚îÄ‚îÄ telegramService.js     # Telegram –±–æ—Ç —Å–ø–æ–≤—ñ—â–µ–Ω—å
‚îú‚îÄ‚îÄ tvClient.js            # –ö–ª—ñ—î–Ω—Ç TradingView Scanner API
‚îú‚îÄ‚îÄ screenshot-service.js  # –°–µ—Ä–≤—ñ—Å —Å–∫—Ä—ñ–Ω—à–æ—Ç—ñ–≤ –≥—Ä–∞—Ñ—ñ–∫—ñ–≤ (Playwright)
‚îú‚îÄ‚îÄ logger.js              # –¶–µ–Ω—Ç—Ä–∞–ª—ñ–∑–æ–≤–∞–Ω–µ –ª–æ–≥—É–≤–∞–Ω–Ω—è
‚îú‚îÄ‚îÄ errorHandler.js        # –û–±—Ä–æ–±–∫–∞ –ø–æ–º–∏–ª–æ–∫
‚îú‚îÄ‚îÄ validation.js          # –í–∞–ª—ñ–¥–∞—Ü—ñ—è –¥–∞–Ω–∏—Ö
‚îú‚îÄ‚îÄ utils.js               # –†–µ–µ–∫—Å–ø–æ—Ä—Ç —É—Ç–∏–ª—ñ—Ç
‚îî‚îÄ‚îÄ utils/
    ‚îú‚îÄ‚îÄ time.js            # –†–æ–±–æ—Ç–∞ –∑ —á–∞—Å–æ–º (NY timezone)
    ‚îú‚îÄ‚îÄ format.js          # –§–æ—Ä–º–∞—Ç—É–≤–∞–Ω–Ω—è –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å
    ‚îú‚îÄ‚îÄ state.js           # State manager
    ‚îî‚îÄ‚îÄ hof.js             # Higher-order functions (retry, logging)
```

## üîÑ –ü–æ—Ç—ñ–∫ –¥–∞–Ω–∏—Ö

```mermaid
graph TD
    A[app.js] --> B[scannerService]
    B --> C{Premarket?<br>04:00-09:30 ET}
    C -->|–¢–∞–∫| D[startScanner]
    C -->|–ù—ñ| E[stopScanner]
    D --> F[scanOnce –∫–æ–∂–Ω—ñ 10—Å]
    F --> G[tvClient.getStocks10]
    G --> H[TradingView API]
    H --> I[–§—ñ–ª—å—Ç—Ä–∞—Ü—ñ—è –Ω–æ–≤–∏—Ö –∞–∫—Ü—ñ–π]
    I --> J[telegramService.sendMessage]
    J --> K[Telegram Bot ‚Üí Chat/Thread]
```

## üìã –ú–æ–¥—É–ª—ñ

### `app.js` ‚Äî –¢–æ—á–∫–∞ –≤—Ö–æ–¥—É
- –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑—É—î –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—é —Ç–∞ —Å–µ—Ä–≤—ñ—Å–∏
- –ù–∞–ª–∞—à—Ç–æ–≤—É—î graceful shutdown (SIGINT, SIGTERM)
- –û–±—Ä–æ–±–ª—è—î –≥–ª–æ–±–∞–ª—å–Ω—ñ –ø–æ–º–∏–ª–∫–∏

### `scannerService.js` ‚Äî –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫
- **Gatekeeper**: –ü–µ—Ä–µ–≤—ñ—Ä—è—î —á–∏ –∑–∞—Ä–∞–∑ –ø—Ä–µ–º–∞—Ä–∫–µ—Ç (–∫–æ–∂–Ω—ñ 30 —Å–µ–∫)
- –ó–∞–ø—É—Å–∫–∞—î/–∑—É–ø–∏–Ω—è—î —Å–∫–∞–Ω–µ—Ä –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ
- State management –¥–ª—è –≤—ñ–¥—Å—Ç–µ–∂–µ–Ω–Ω—è –ø–æ–±–∞—á–µ–Ω–∏—Ö —Å–∏–º–≤–æ–ª—ñ–≤

### `stockService.js` ‚Äî –û–±—Ä–æ–±–∫–∞ –∞–∫—Ü—ñ–π
- –û—Ç—Ä–∏–º—É—î –¥–∞–Ω—ñ –∑ TradingView API
- –§—ñ–ª—å—Ç—Ä—É—î: —Ç—ñ–ª—å–∫–∏ –Ω–æ–≤—ñ + float ‚â§ 15M
- –ù–∞–¥—Å–∏–ª–∞—î —Å–ø–æ–≤—ñ—â–µ–Ω–Ω—è –¥–ª—è –∫–æ–∂–Ω–æ—ó –Ω–æ–≤–æ—ó –∞–∫—Ü—ñ—ó

### `tvClient.js` ‚Äî TradingView API
- POST –∑–∞–ø–∏—Ç –¥–æ `scanner.tradingview.com/america/scan`
- Browser-like headers –¥–ª—è –æ–±—Ö–æ–¥—É –±–ª–æ–∫—É–≤–∞–Ω–Ω—è
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω—ñ retry –∑ exponential backoff
- –§—ñ–ª—å—Ç—Ä–∏: common/preferred stocks, DR

### `telegramService.js` ‚Äî Telegram
- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î –±—ñ–±–ª—ñ–æ—Ç–µ–∫—É `telegraf`
- –ü—ñ–¥—Ç—Ä–∏–º–∫–∞ thread ID –¥–ª—è —Ç–æ–ø—ñ–∫—ñ–≤
- Fallback —è–∫—â–æ thread_id –Ω–µ –ø—Ä–∞—Ü—é—î
- Retry logic –¥–ª—è –Ω–∞–¥—ñ–π–Ω–æ—Å—Ç—ñ

### `screenshot-service.js` ‚Äî –°–∫—Ä—ñ–Ω—à–æ—Ç–∏
- Playwright –¥–ª—è headless –±—Ä–∞—É–∑–µ—Ä–∞
- –†–æ–±–∏—Ç—å —Å–∫—Ä—ñ–Ω—à–æ—Ç–∏ 4H —Ç–∞ 1M –≥—Ä–∞—Ñ—ñ–∫—ñ–≤
- –°–∫–ª–µ—é—î –≤ –æ–¥–Ω–µ –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è (sharp)
- –í—ñ–¥–ø—Ä–∞–≤–ª—è—î –≤ Telegram

## ‚öôÔ∏è –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è

### –ó–º—ñ–Ω–Ω—ñ —Å–µ—Ä–µ–¥–æ–≤–∏—â–∞ (.env)

```env
# Telegram Bot Configuration
BOT_TOKEN=your_telegram_bot_token
CHAT_ID=your_telegram_chat_id
THREAD_ID=your_telegram_thread_id_optional

# Trading Configuration
PREMARKET_THRESHOLD=10        # –ú—ñ–Ω—ñ–º–∞–ª—å–Ω–∏–π % –∑—Ä–æ—Å—Ç–∞–Ω–Ω—è
SCAN_INTERVAL_MS=10000        # –Ü–Ω—Ç–µ—Ä–≤–∞–ª —Å–∫–∞–Ω—É–≤–∞–Ω–Ω—è (–º—Å)
SEND_ON_STARTUP=false         # –ù–∞–¥—Å–∏–ª–∞—Ç–∏ –≤—Å—ñ –∞–∫—Ü—ñ—ó –ø—Ä–∏ —Å—Ç–∞—Ä—Ç—ñ
```

### –ö–ª—é—á–æ–≤—ñ –ø–∞—Ä–∞–º–µ—Ç—Ä–∏

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –ó–Ω–∞—á–µ–Ω–Ω—è | –û–ø–∏—Å |
|----------|----------|------|
| `premarketHours.start` | `04:00` | –ü–æ—á–∞—Ç–æ–∫ –ø—Ä–µ–º–∞—Ä–∫–µ—Ç—É (ET) |
| `premarketHours.end` | `09:30` | –ö—ñ–Ω–µ—Ü—å –ø—Ä–µ–º–∞—Ä–∫–µ—Ç—É (ET) |
| `premarketThreshold` | `10` | –ú—ñ–Ω—ñ–º–∞–ª—å–Ω–∏–π % –∑—Ä–æ—Å—Ç–∞–Ω–Ω—è |
| `scanIntervalMs` | `10000` | –Ü–Ω—Ç–µ—Ä–≤–∞–ª —Å–∫–∞–Ω—É–≤–∞–Ω–Ω—è (10 —Å–µ–∫) |
| `gatekeeperIntervalMs` | `30000` | –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —á–∞—Å—É (30 —Å–µ–∫) |

## üì¶ –ó–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ

```json
{
  "telegraf": "^4.16.3",     // Telegram Bot API
  "dotenv": "^16.4.5",       // –ó–º—ñ–Ω–Ω—ñ —Å–µ—Ä–µ–¥–æ–≤–∏—â–∞
  "playwright": "^1.55.0",   // –°–∫—Ä—ñ–Ω—à–æ—Ç–∏ –±—Ä–∞—É–∑–µ—Ä–∞
  "sharp": "^0.34.3"         // –û–±—Ä–æ–±–∫–∞ –∑–æ–±—Ä–∞–∂–µ–Ω—å
}
```

## üöÄ –ó–∞–ø—É—Å–∫

### –õ–æ–∫–∞–ª—å–Ω–æ

```bash
# –í—Å—Ç–∞–Ω–æ–≤–∏—Ç–∏ –∑–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ
npm install

# –ó–∞–ø—É—Å—Ç–∏—Ç–∏
npm start

# –ê–±–æ –≤ dev —Ä–µ–∂–∏–º—ñ (–∑ debug)
npm run dev
```

### Docker

```bash
# –ó—ñ–±—Ä–∞—Ç–∏ –æ–±—Ä–∞–∑
docker build -t stocks10-watcher .

# –ó–∞–ø—É—Å—Ç–∏—Ç–∏
docker run -d --env-file .env stocks10-watcher
```

### Fly.io

–ü—Ä–æ–µ–∫—Ç –≥–æ—Ç–æ–≤–∏–π –¥–æ –¥–µ–ø–ª–æ—é –Ω–∞ Fly.io (–¥–∏–≤. `fly.toml`).

## üìù –§–æ—Ä–º–∞—Ç —Å–ø–æ–≤—ñ—â–µ–Ω—å

```
üìà NASDAQ:STEC
‚Ä¢ Price: $2.45
‚Ä¢ Change: +45.67%
‚Ä¢ Float: 5.2M
‚Ä¢ Vol: 1.2M
‚Ä¢ $Dol-Vol$: $2.9M
```

## üîç –ö—Ä–∏—Ç–µ—Ä—ñ—ó —Ñ—ñ–ª—å—Ç—Ä–∞—Ü—ñ—ó

TradingView Scanner API —Ñ—ñ–ª—å—Ç—Ä–∏:

```javascript
{
  filter: [
    { left: "premarket_volume", operation: "greater", right: 50000 },
    { left: "premarket_change", operation: "greater", right: 10 },
    { left: "premarket_close", operation: "egreater", right: 0.8 }
  ],
  filter2: {
    // –¢—ñ–ª—å–∫–∏ common stocks, preferred stocks, DR
    // –í–∏–∫–ª—é—á–∞—î ETF, —Ñ–æ–Ω–¥–∏, —Ç–æ—â–æ
  }
}
```

–î–æ–¥–∞—Ç–∫–æ–≤–∏–π —Ñ—ñ–ª—å—Ç—Ä —É –∫–æ–¥—ñ:
- `float_shares_outstanding ‚â§ 15,000,000` (–∞–±–æ null)

## üõ°Ô∏è –û–±—Ä–æ–±–∫–∞ –ø–æ–º–∏–ª–æ–∫

- **TradingViewError**: –ü–æ–º–∏–ª–∫–∏ API (429 rate limit, 403 forbidden)
- **TelegramError**: –ü–æ–º–∏–ª–∫–∏ –Ω–∞–¥—Å–∏–ª–∞–Ω–Ω—è –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å
- **ConfigurationError**: –ù–µ–≤–∞–ª—ñ–¥–Ω–∞ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è
- **ValidationError**: –ù–µ–≤–∞–ª—ñ–¥–Ω—ñ –¥–∞–Ω—ñ

–ì–ª–æ–±–∞–ª—å–Ω—ñ –ø–æ–º–∏–ª–∫–∏ –ª–æ–≥—É—é—Ç—å—Å—è —Ç–∞ –Ω–∞–¥—Å–∏–ª–∞—é—Ç—å—Å—è –≤ Telegram.

## üìä –õ–æ–≥—É–≤–∞–Ω–Ω—è

–°—Ç—Ä—É–∫—Ç—É—Ä–æ–≤–∞–Ω–µ –ª–æ–≥—É–≤–∞–Ω–Ω—è –∑ —Ä—ñ–≤–Ω—è–º–∏:
- `DEBUG` ‚Äî –¥–µ—Ç–∞–ª—å–Ω–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è
- `INFO` ‚Äî –∑–≤–∏—á–∞–π–Ω—ñ –æ–ø–µ—Ä–∞—Ü—ñ—ó
- `WARN` ‚Äî –ø–æ–ø–µ—Ä–µ–¥–∂–µ–Ω–Ω—è
- `ERROR` ‚Äî –ø–æ–º–∏–ª–∫–∏

–ü—Ä–∏–∫–ª–∞–¥:
```
[12:34:56] [INFO] [SCANNER] üîî –Ω–æ–≤–∏–π: NASDAQ:STEC, change=45.67%
[12:34:56] [INFO] [TG] sent ‚úî id=123456 chat=-100xxx thread=789
```

## üìÖ –†–æ–∑–∫–ª–∞–¥ —Ä–æ–±–æ—Ç–∏

- **–ü–Ω-–ü—Ç**: 04:00‚Äì09:30 ET (–ø—Ä–µ–º–∞—Ä–∫–µ—Ç)
- **–°–±-–ù–¥**: –ù–µ –ø—Ä–∞—Ü—é—î (–≤–∏—Ö—ñ–¥–Ω—ñ)
- **–ü–æ–∑–∞ –ø—Ä–µ–º–∞—Ä–∫–µ—Ç–æ–º**: –°–∫–∞–Ω–µ—Ä –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –∑—É–ø–∏–Ω—è—î—Ç—å—Å—è

## üîß –¢–µ—Ö–Ω—ñ—á–Ω—ñ –¥–µ—Ç–∞–ª—ñ

### TradingView API

–ü—Ä–æ–µ–∫—Ç –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î –Ω–µ–¥–æ–∫—É–º–µ–Ω—Ç–æ–≤–∞–Ω–∏–π TradingView Scanner API:
- URL: `https://scanner.tradingview.com/america/scan`
- –ú–µ—Ç–æ–¥: POST
- Headers: Browser-like –¥–ª—è –æ–±—Ö–æ–¥—É –±–ª–æ–∫—É–≤–∞–Ω–Ω—è
- Timeout: 12 —Å–µ–∫—É–Ω–¥
- Retries: 2 —Å–ø—Ä–æ–±–∏ –∑ exponential backoff

### State Management

```javascript
{
  isRunning: false,        // –ß–∏ –ø—Ä–∞—Ü—é—î —Å–∫–∞–Ω–µ—Ä
  isFirstScan: true,       // –ü–µ—Ä—à–∏–π —Å–∫–∞–Ω (suppress notifications)
  seenSymbols: new Set(),  // –í–∂–µ –ø–æ–±–∞—á–µ–Ω—ñ —Å–∏–º–≤–æ–ª–∏
  scanTimer: null,         // –¢–∞–π–º–µ—Ä —Å–∫–∞–Ω—É–≤–∞–Ω–Ω—è
  gateTimer: null          // –¢–∞–π–º–µ—Ä gatekeeper
}
```

## ‚ö†Ô∏è –í–∞–∂–ª–∏–≤–æ

> ‚ö†Ô∏è **–ù–ï –ß–Ü–ü–ê–¢–ò `tvClient.js` –±–µ–∑ –∫—Ä–∞–π–Ω—å–æ—ó –ø–æ—Ç—Ä–µ–±–∏!**
> TradingView –º–æ–∂–µ –∑–∞–±–ª–æ–∫—É–≤–∞—Ç–∏ –ø—Ä–∏ –∑–º—ñ–Ω—ñ headers –∞–±–æ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏ –∑–∞–ø–∏—Ç—É.

## üìÑ –õ—ñ—Ü–µ–Ω–∑—ñ—è

MIT
